services:
  mongo:
    image: mongo:7
    container_name: stosyst-db
    restart: always
    volumes:
      - mongo_data:/data/db
    networks:
      - stosyst-network

  api:
    image: ${IMAGE}   # ðŸ‘ˆ passed from .env (your CI writes IMAGE=...)
    container_name: stosyst-api
    restart: always
    depends_on:
      - mongo
    env_file:
      - .env
    ports:
      - "5000:5000"
    networks:
      - stosyst-network

  client:
    image: shehuzaks/stosyst-client:latest  # ðŸ‘ˆ or pass via env if you want
    container_name: stosyst-client
    environment:
      - PUBLIC_URL=.
      - NODE_ENV=production
      - API_URL=http://stosyst.store/graphql
      - SOCKET_URL=ws://stosyst.com
      - REACT_APP_FIREBASE_API_KEY=AIzaSyCDiya-9JxBX8fEHVPSFhb9d83SwkjM0bw
      - REACT_APP_FIREBASE_AUTH_DOMAIN=nexto-5eeba.firebaseapp.com
      - REACT_APP_FIREBASE_PROJECT_ID=nexto-5eeba
      - REACT_APP_FIREBASE_STORAGE_BUCKET=nexto-5eeba.appspot.com
      - REACT_APP_FIREBASE_MESSAGING_SENDER_ID=123557233842
      - REACT_APP_FIREBASE_APP_ID=1:123557233842:web:6ac7bd066c6d282d3735ab
      - REACT_APP_FIREBASE_MEASUREMENT_ID=G-BK1Y87GTXM
      - REACT_APP_FIREBASE_VAPID_KEY=BCheeVz1kZCc0CnM2ZL1tgNtmzUKzb9FPDYRytPfOFmMoutVYIwisWHJMVg7zYc59Hg1TszRNHdtr7uxdGX0AEw
      
      - REACT_APP_API_HOST=stosyst.store
    restart: always
    ports:
      - "80:80"
    # volumes:
    #   - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - stosyst-network

volumes:
  mongo_data:

networks:
  stosyst-network:
    driver: bridge
